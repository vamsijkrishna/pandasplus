global:
    encoding: "utf-8"
    seperator: ","
    name: china
    source : "$CHINA_FOLDER/<year>/<year>-<month>.txt"
    source_vars:
        year:
            start: 2005
            end: 2005
        month:
            start: 1
            end: 12
            zfill: 2
    concat: YES

    output : "$CHINA_FOLDER/output/<year>/<month>"

    type:
        "$ amount": "safe_float"

    agg:
        "quantity": "sum"
        "$ amount": "sum"

    transform:
        "import or export":
            type: "unstack"
            target: "import or export"
        "province and city":
            -
                type: "func"
                func: "plugins.attribute_map.find_zip"
            -
                type: "prepend"
                value: "CN"
        "HS8":
            - 
                type: "slice"
                length: 4
            - 
                type: "DBLOOKUP"
                table: "attrs_hs"
                key: "substr(id, 3)"
                value: "id"
                where: "char_length(id) = 6"


tables:
    ymgp:
        pk: ["year", "month", "province and city", "HS8"]
        depths: { "year": ["identity"], "month":["identity"], "province and city" : [2, 4, YES], "HS8": [2, YES]  }

    ygp:
        pk: ["year", "province and city", "HS8"]
        depths: { "year": ["identity"], "province and city" : [2, 4, YES], "HS8": [2, YES]  }
        rca:
            index: ["year", "province and city"]
            column: "HS8"
            values: [$ amount出口]

